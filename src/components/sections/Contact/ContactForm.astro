---
import { Icon } from "astro-icon/components";
import CustomSelectWhite from "./CustomSelectWhite.astro";

interface FormFields {
  name: {
    label: string;
    placeholder: string;
  };
  email: {
    label: string;
    placeholder: string;
  };
  subject: {
    label: string;
    options: string[];
  };
  message: {
    label: string;
    placeholder: string;
  };
}

interface Props {
  title: string;
  fields: FormFields;
  submitLabel: string;
}

const { title, fields, submitLabel } = Astro.props;
---

<div class="contact-form-wrapper">
  <h2 class="form-title">{title}</h2>
  <form class="contact-form">
    <div class="form-row">
      <div class="form-field">
        <label class="form-label" for="name">{fields.name.label}</label>
        <input
          class="form-input"
          id="name"
          name="name"
          placeholder={fields.name.placeholder}
          type="text"
          required
        />
      </div>
      <div class="form-field">
        <label class="form-label" for="email">{fields.email.label}</label>
        <input
          class="form-input"
          id="email"
          name="email"
          placeholder={fields.email.placeholder}
          type="email"
          required
        />
      </div>
    </div>

    <div class="form-field">
      <CustomSelectWhite
        id="subject"
        label={fields.subject.label}
        options={fields.subject.options}
      />
    </div>

    <div class="form-field">
      <label class="form-label" for="message">{fields.message.label}</label>
      <textarea
        class="form-textarea"
        id="message"
        name="message"
        placeholder={fields.message.placeholder}
        rows="5"
        required
      ></textarea>
    </div>

    <button class="form-submit" type="submit">
      {submitLabel}
      <Icon name="mdi:send" size={20} class="submit-icon" />
    </button>
  </form>
</div>

<style>
  .contact-form-wrapper {
    background-color: rgba(42, 42, 42, 0.4);
    padding: var(--space-8);
    border: 1px solid var(--surface-dark);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    transition: border-color 0.3s ease;
  }

  /* Animação de piscada laranja */
  .contact-form-wrapper.form-flash {
    animation: flashBorder 3s ease-in-out;
  }

  @keyframes flashBorder {
    0%, 100% {
      border-color: var(--surface-dark);
      box-shadow: none;
    }
    10%, 30%, 50%, 70%, 90% {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(255, 107, 0, 0.5);
    }
    20%, 40%, 60%, 80% {
      border-color: var(--surface-dark);
      box-shadow: none;
    }
  }

  @media (min-width: 768px) {
    .contact-form-wrapper {
      padding: var(--space-10);
    }
  }

  .form-title {
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--text-primary-dark);
    text-transform: uppercase;
    margin-bottom: var(--space-6);
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-5);
  }

  @media (min-width: 768px) {
    .form-row {
      grid-template-columns: 1fr 1fr;
    }
  }

  .form-field {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .form-label {
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    color: var(--text-secondary-dark);
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    background-color: var(--background-light);
    color: var(--background-dark);
    padding: var(--space-3) var(--space-4);
    outline: none;
    border: none;
    font-weight: var(--font-medium);
    font-family: var(--font-body);
    transition: all var(--transition-base);
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    ring: 2px;
    ring-color: var(--primary);
    border-color: transparent;
  }

  .form-input::placeholder,
  .form-textarea::placeholder {
    color: #6b7280;
  }

  .form-select {
    color: #374151;
  }

  .form-textarea {
    resize: none;
  }

  .form-submit {
    margin-top: var(--space-4);
    width: 100%;
    background-color: var(--primary);
    color: var(--background-dark);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    padding: var(--space-4) var(--space-8);
    border: none;
    cursor: pointer;
    font-family: var(--font-display);
    transition: background-color var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
  }

  .form-submit:hover {
    background-color: var(--white);
  }

  .submit-icon {
    transition: transform var(--transition-base);
  }

  .form-submit:hover .submit-icon {
    transform: translateX(0.25rem);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('.contact-form') as HTMLFormElement;
    const nameInput = document.getElementById('name') as HTMLInputElement;
    const emailInput = document.getElementById('email') as HTMLInputElement;
    const messageInput = document.getElementById('message') as HTMLTextAreaElement;

    if (!form) return;

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const name = nameInput?.value.trim();
      const email = emailInput?.value.trim();
      const message = messageInput?.value.trim();

      // Pegar o assunto do select customizado
      const subjectHiddenInput = document.querySelector('input[name="subject"]') as HTMLInputElement;
      const subject = subjectHiddenInput?.value || '';

      // Validação básica
      if (!name || !email || !subject || !message) {
        alert('Por favor, preencha todos os campos.');
        return;
      }

      // Validar formato de email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('Por favor, digite um e-mail válido.');
        return;
      }

      // Montar corpo do email formatado
      const emailBody = `
Nome: ${name}
E-mail: ${email}
Assunto: ${subject}

Mensagem:
${message}

---
Mensagem enviada através do formulário de contato do site HJLOG.
      `.trim();

      // Criar link mailto
      const mailtoLink = `mailto:adm@hjlogtransportes.com.br?subject=${encodeURIComponent(`Contato Site - ${subject}`)}&body=${encodeURIComponent(emailBody)}`;

      // Abrir cliente de email
      window.location.href = mailtoLink;

      // Limpar formulário após envio
      form.reset();
    });
  });
</script>
