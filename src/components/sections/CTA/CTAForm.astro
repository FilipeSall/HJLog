---
interface Props {
  emailPlaceholder: string;
  ctaLabel: string;
}

const { emailPlaceholder, ctaLabel } = Astro.props;
---

<form class="cta-form" id="cta-form">
  <input
    class="cta-input"
    id="cta-email"
    name="email"
    placeholder={emailPlaceholder}
    type="email"
    required
  />
  <button
    class="cta-button"
    type="submit"
  >
    {ctaLabel}
  </button>
</form>

<style>
  /* Formulário */
  .cta-form {
    display: flex;
    flex-direction: column;
    gap: 0;
    max-width: 32rem;
    margin: 0 auto var(--space-16);
    box-shadow: var(--shadow-2xl);
  }

  /* Campo do formulário */
  .cta-input {
    flex: 1;
    background-color: var(--background-light);
    color: var(--background-dark);
    padding: var(--space-4) var(--space-6);
    outline: none;
    border: none;
    font-weight: var(--font-medium);
    font-family: var(--font-body);
    transition: background-color var(--transition-base);
  }

  .cta-input::placeholder {
    color: #999999;
  }

  .cta-input:focus {
    ring: none;
    border: none;
    outline: none;
  }

  /* Botão do formulário */
  .cta-button {
    background-color: var(--primary);
    color: var(--background-dark);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    padding: var(--space-4) var(--space-8);
    border: none;
    cursor: pointer;
    white-space: nowrap;
    font-family: var(--font-display);
    transition: background-color var(--transition-base);
  }

  .cta-button:hover {
    background-color: var(--white);
  }

  /* Design responsivo */
  @media (min-width: 640px) {
    .cta-form {
      flex-direction: row;
    }
  }

  /* Estado de erro */
  .cta-input.error {
    background-color: #ffe6e6;
    border: 2px solid #ff4444;
  }

  .cta-input.error::placeholder {
    color: #ff4444;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('cta-form') as HTMLFormElement;
    const emailInput = document.getElementById('cta-email') as HTMLInputElement;

    if (!form || !emailInput) return;

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const email = emailInput.value.trim();

      // Validar formato do e-mail
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!email) {
        emailInput.classList.add('error');
        emailInput.placeholder = 'Por favor, digite seu e-mail';
        emailInput.focus();
        return;
      }

      if (!emailRegex.test(email)) {
        emailInput.classList.add('error');
        emailInput.value = '';
        emailInput.placeholder = 'Por favor, digite um e-mail válido';
        emailInput.focus();
        return;
      }

      // Remover estado de erro, se presente
      emailInput.classList.remove('error');

      // Redirecionar para a página de cotação com o parâmetro de e-mail
      window.location.href = `/cotacao?email=${encodeURIComponent(email)}`;
    });

    // Remover estado de erro ao digitar
    emailInput.addEventListener('input', () => {
      emailInput.classList.remove('error');
    });
  });
</script>
